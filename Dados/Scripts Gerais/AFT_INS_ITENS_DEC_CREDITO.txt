SET TERM #;
CREATE TRIGGER AFT_INS_ITENS_DEC_CREDITO FOR ITENS_DEC_CREDITO
ACTIVE AFTER INSERT POSITION 0
AS
DECLARE VARIABLE TUPLAS SMALLINT;
DECLARE VARIABLE NVALOR DECIMAL(10,2);
DECLARE VARIABLE NFICHA INTEGER;
DECLARE VARIABLE NITENSFICHA_ID INTEGER;
DECLARE VARIABLE NDATA DATE;
DECLARE VARIABLE NSU_CE VARCHAR(2);
DECLARE VARIABLE NDECRETO VARCHAR(9);
BEGIN
 SELECT FICHA, VALOR FROM ITENS_DEC_CREDITO
 WHERE
   ITENS_DEC_CREDITO_ID = NEW.ITENS_DEC_CREDITO_ID
 INTO :NFICHA, :NVALOR;

 SELECT DECRETO_ID, DATA, SU_CE FROM DECRETO
 WHERE
   DECRETO_ID = NEW.DECRETO_ID
 INTO :NDECRETO, :NDATA, :NSU_CE;
 
 SELECT MAX(ITENSFICHA_ID) FROM ITENSFICHA INTO :NITENSFICHA_ID;
 
 IF ((:NSU_CE = 'SU') OR (:NSU_CE = 'CE')) THEN BEGIN
   INSERT INTO ITENSFICHA(ITENSFICHA_ID, FICHA_ID, VALORANULACAO, VALORSUPLEMENTACAO, VALORPROCESSO, DATA, NUMDECRETO)
   VALUES ((:NITENSFICHA_ID+1), :NFICHA, 0, :NVALOR, 0, :NDATA, :NDECRETO);
 END

END #;