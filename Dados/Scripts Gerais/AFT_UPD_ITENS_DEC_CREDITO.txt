
SET TERM #;
CREATE TRIGGER AFT_UPD_ITENS_DEC_CREDITO FOR ITENS_DEC_CREDITO
ACTIVE AFTER UPDATE POSITION 0
AS
DECLARE VARIABLE TUPLAS SMALLINT;
DECLARE VARIABLE NVALOR DECIMAL(10,2);
DECLARE VARIABLE NFICHA INTEGER;
DECLARE VARIABLE NDATA DATE;
DECLARE VARIABLE NSU_CE VARCHAR(2);
DECLARE VARIABLE NDECRETO VARCHAR(9);
BEGIN
 SELECT FICHA, VALOR FROM ITENS_DEC_CREDITO
 WHERE
   ITENS_DEC_CREDITO_ID = NEW.ITENS_DEC_CREDITO_ID
 INTO :NFICHA, :NVALOR;

 SELECT DECRETO_ID, DATA, SU_CE FROM DECRETO
 WHERE
   DECRETO_ID = NEW.DECRETO_ID
 INTO :NDECRETO, :NDATA, :NSU_CE;

 IF ((:NSU_CE = 'SU') OR (:NSU_CE = 'CE')) THEN BEGIN
   UPDATE ITENSFICHA SET
   FICHA_ID = :NFICHA,
   VALORANULACAO = 0,
   VALORSUPLEMENTACAO = :NVALOR,
   VALORPROCESSO = 0,
   DATA = :NDATA,
   NUMDECRETO = :NDECRETO
   WHERE
     NUMDECRETO = :NDECRETO AND FICHA_ID = NEW.FICHA;

 END

END #;